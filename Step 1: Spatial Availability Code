#### Install R packages ####
library (RMark)

#### Using assymmetric species interaction models from Richmond et al. 2010: DOI:10.2307/25741366
#### Run for each predator/prey interaction assessed, for each strata. Can also incorporate covariates, if needed

# Input capture history file
occupancy_input_file = import.chdata("C:\\filepath\\capturehistories.txt",header = TRUE, field.names = NULL, field.types = c("f", "n"))

set.seed(1)

# 1 Model Dot Model - Predator occupancy affects prey occupancy

PsiA.Dot_PsiBA.Dot_PsiBa.Dot_pA.Dot_pB.Dot_rA.Dot_rBA.Dot_rBa.Dot = mark(occupancy_input_file, model = "2SpecConOccup", 
                                                                         model.parameters = list(PsiA = list(formula = ~1, link = "sin"),
                                                                                                 PsiBA = list(formula = ~1, link = "sin"),
                                                                                                 PsiBa = list(formula = ~1, link = "sin"),
                                                                                                 pA = list(formula = ~1),
                                                                                                 pB = list(formula = ~1),
                                                                                                 rA = list(formula = ~1),
                                                                                                 rBA = list(formula = ~1),
                                                                                                 rBa = list(formula = ~1)
                                                                         ), options = "SIMANNEAL")  # end statement


# 2 Model PsiBA = PsiBa - Predator occupancy does not affect prey occupancy

PsiA.Dot_PsiBA.Dot.EQUAL.PsiBa.Dot_pA.Dot_pB.Dot_rA.Dot_rBA.Dot_rBa.Dot = mark(occupancy_input_file, model = "2SpecConOccup", 
                                                                               model.parameters = list(PsiA = list(formula = ~1, link = "sin"), 
                                                                                                       PsiBA = list(formula = ~1, link = "sin", share=TRUE), 
                                                                                                       pA = list(formula = ~1),  
                                                                                                       pB = list(formula = ~1), 
                                                                                                       rA = list(formula = ~1),  
                                                                                                       rBA = list(formula = ~1),  
                                                                                                       rBa = list(formula = ~1) 
                                                                               ), options = "SIMANNEAL") 

# Summarize all of the models in an AIC table

multiple.model.results = collect.models()  
multiple.model.results$model.table=model.table(multiple.model.results,model.name=F)
options(width = 200)
multiple.model.results 

# Run for top model
PsiA.Dot_PsiBA.Dot.EQUAL.PsiBa.Dot_pA.Dot_pB.Dot_rA.Dot_rBA.Dot_rBa.Dot$results$beta  
PsiA.Dot_PsiBA.Dot.EQUAL.PsiBa.Dot_pA.Dot_pB.Dot_rA.Dot_rBA.Dot_rBa.Dot$results$real 
PsiA.Dot_PsiBA.Dot.EQUAL.PsiBa.Dot_pA.Dot_pB.Dot_rA.Dot_rBA.Dot_rBa.Dot$results$derived  #occupancy of both species is in here

